# Architecture Diagrams - Text-based

## System Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                    LEAN WMS MONOREPO                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐ │
│  │  client-web  │      │    mobile     │      │     api      │ │
│  │  (React)     │      │   (Expo)      │      │   (Rust)     │ │
│  │  Web+Desktop │      │  React Native │      │    Axum      │ │
│  └──────┬───────┘      └──────┬───────┘      └──────┬───────┘ │
│         │                      │                      │         │
│         │                      │                      │         │
│         │                      │                      │         │
│         └──────────────────────┼──────────────────────┘         │
│                                │                                 │
│                    ┌───────────▼───────────┐                     │
│                    │   packages/core       │                     │
│                    │   (TypeScript)        │                     │
│                    │   - FEFO/FIFO        │                     │
│                    │   - Validation        │                     │
│                    │   - Types             │                     │
│                    └───────────────────────┘                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Data Flow - Frontend to Backend

```
┌─────────────┐
│   Component │
│  (React)     │
└──────┬───────┘
       │
       │ User Action
       │
┌──────▼──────────┐
│  Redux Action   │
│  (dispatch)     │
└──────┬──────────┘
       │
       │
┌──────▼──────────┐         ┌─────────────┐
│  API Service   │────────▶│  Backend    │
│  (axios)       │  HTTP   │  (Axum)     │
└──────┬──────────┘         └─────┬───────┘
       │                            │
       │                            │ SQL
       │                            │
┌──────▼──────────┐         ┌──────▼───────┐
│  Redux Store    │         │  PostgreSQL   │
│  (State)        │         │  Database     │
└─────────────────┘         └──────────────┘
```

## Monorepo Dependency Graph

```
                    ┌─────────────┐
                    │   Root      │
                    │ package.json│
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
┌───────▼──────┐  ┌────────▼────────┐  ┌──────▼──────┐
│ client-web   │  │ packages/core  │  │    api     │
│              │  │                │  │            │
│ depends on:  │  │ exports:       │  │ (Rust)     │
│ - @lean-wms/ │◀─│ - FEFO/FIFO    │  │            │
│   core       │  │ - Validation    │  │ (không dùng│
│ - react      │  │ - Types         │  │  core)    │
│ - redux      │  └─────────────────┘  └────────────┘
└──────────────┘
        │
        │
┌───────▼──────┐
│   mobile     │
│              │
│ depends on:  │
│ - @lean-wms/ │◀──┐
│   core       │   │
│ - expo       │   │
│ - redux      │   │
└──────────────┘   │
                   │
                   │
         ┌─────────┘
         │
┌────────▼─────────┐
│ packages/core    │
│                  │
│ dependencies:    │
│ - zod            │
│ - date-fns       │
└──────────────────┘
```

## Authentication Flow

```
┌─────────┐         ┌─────────┐         ┌─────────┐
│ Client  │         │  API    │         │   DB    │
└────┬────┘         └────┬────┘         └────┬────┘
     │                   │                    │
     │ 1. POST /auth/    │                    │
     │    login          │                    │
     │──────────────────▶│                    │
     │                   │ 2. Verify          │
     │                   │    credentials     │
     │                   │───────────────────▶│
     │                   │                    │
     │                   │ 3. User data       │
     │                   │◀───────────────────│
     │                   │                    │
     │ 4. JWT + Refresh  │                    │
     │    Token          │                    │
     │◀──────────────────│                    │
     │                   │                    │
     │ 5. Store tokens   │                    │
     │    (localStorage) │                    │
     │                   │                    │
     │ 6. API Request    │                    │
     │    + JWT Header   │                    │
     │──────────────────▶│                    │
     │                   │ 7. Verify JWT      │
     │                   │───────────────────▶│
     │                   │                    │
     │                   │ 8. Valid           │
     │                   │◀───────────────────│
     │                   │                    │
     │ 9. Response       │                    │
     │◀──────────────────│                    │
```

## Build Pipeline (Turbo)

```
┌─────────────┐
│  pnpm dev   │
└──────┬──────┘
       │
       │ Turbo orchestrates
       │
   ┌───┴───┐
   │       │
┌──▼──┐ ┌──▼──┐ ┌──────┐
│core │ │web  │ │mobile│
│build│ │dev  │ │dev   │
└──┬──┘ └──┬──┘ └──┬───┘
   │       │       │
   │       │       │
   └───┬───┴───┬───┘
       │       │
   ┌───▼───┐ ┌─▼───┐
   │  API  │ │ ... │
   │  dev  │ │     │
   └───────┘ └─────┘
```

## Deployment Architecture (Future)

```
                    ┌─────────────┐
                    │   Users     │
                    │ (Mobile/Web)│
                    └──────┬──────┘
                           │ HTTPS
                           │
                    ┌──────▼──────────┐
                    │  Load Balancer  │
                    │  (Nginx/Cloud)  │
                    └──────┬──────────┘
                           │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
┌───────▼──────┐   ┌────────▼────────┐  ┌──────▼──────┐
│  API Server │   │  API Server    │  │  API Server │
│  (Instance1)│   │  (Instance2)   │  │  (Instance3)│
└──────┬──────┘   └────────┬────────┘  └──────┬──────┘
       │                   │                   │
       └───────────────────┼───────────────────┘
                           │
                    ┌──────▼──────────┐
                    │  PostgreSQL     │
                    │  (Primary)      │
                    └─────────────────┘
                           │
                    ┌──────▼──────────┐
                    │  PostgreSQL     │
                    │  (Replica)      │
                    └─────────────────┘
```

